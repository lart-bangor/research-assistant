{# Use with {% from 'lart_macros.html' import lart_form_pipeline %} #}
{% macro lart_form_pipeline(name, target) -%}
    <script type="text/javascript">
        lart.forms.registerPipeline(
            '{{ name }}',
            async function(data) {
                let instanceId = parseInt(lart.forms.searchParams.get('instance'));
                if ( isNaN(instanceId) ) {
                    let success = await eel.{{ target }}(data)();
                } else {
                    let success = await eel.{{ target }}(instanceId, data)();
                }
                console.debug(success);
            }
        );
    </script>
{%- endmacro %}