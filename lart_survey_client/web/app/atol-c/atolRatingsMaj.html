{% set lart_forms = true %}
{%- from 'lart_macros.html' import lart_form_pipeline %}
{% extends 'base.html' %}{% block title %}AToL-RML {% endblock %}
{% block head_scripts %}
<script type="text/javascript">
atolInstanceId = parseInt(lart.forms.searchParams.get('instance'));
chosenVersion = sessionStorage.getItem("atolVersion");

//eel.get_atol_version()(function(data_from_index){myversion = data_from_index});


// instructions to be outputed depending on language selection
if (chosenVersion == "CymEng_Eng_GB") {
    sessionStorage.setItem("version", "CymEng_Eng_GB");
    sessionStorage.setItem("title", "Language Questionnaire");
    sessionStorage.setItem("language", "English");
    sessionStorage.setItem("rml", "Welsh"),
    sessionStorage.setItem("instruction", "Please move the slider to record your choice.");
    sessionStorage.setItem("language_header", "The English language is...");
    sessionStorage.setItem("rml_header", "The Welsh language is...");
    sessionStorage.setItem("atol_header", "AToL Questionnaire (RML)");
    sessionStorage.setItem("btn_text", "Next");
                  
} else if (chosenVersion == "LmoIta_Ita_IT") {
    sessionStorage.setItem("version", "LmoIta_Ita_IT");
    sessionStorage.setItem("title", "Questionario Linguistico");
    sessionStorage.setItem("language", "Italiano");
    sessionStorage.setItem("rml", "lombardo");
    sessionStorage.setItem("instruction", "Si prega di spostare il cursore per registrare la propria scelta.");
    sessionStorage.setItem("language_header", "La lingua italiana è...");
    sessionStorage.setItem("rml_header", "Il lombardo è...");
    sessionStorage.setItem("atol_header", "Questionario AToL (RML)");
    sessionStorage.setItem("btn_text", "Avanti");

} else if (chosenVersion == "LtzGer_Ger_BE") {
    sessionStorage.setItem("version", "LtzGer_Ger_BE");
    sessionStorage.setItem("title", "Sprachlicher Fragebogen");
    sessionStorage.setItem("language", "Deutch");
    sessionStorage.setItem("rml", "Moselfränkisch");
    sessionStorage.setItem("instruction", "Bitte verwenden Sie den Schieberegler, um Ihre Auswahl aufzuzeichnen??.");
    sessionStorage.setItem("language_header", "Die deutsche Sprache ist...");
    sessionStorage.setItem("rml_header", "Moselfränkisch ist...");
    sessionStorage.setItem("atol_header", "AToL Fragebogen (RML)");
    sessionStorage.setItem("btn_text", "Weiter");

}

const title = sessionStorage.getItem("title");
const language = sessionStorage.getItem("language");
const rml = sessionStorage.getItem("rml");
const instruction = sessionStorage.getItem("instruction");
const language_header = sessionStorage.getItem("language_header");
const rml_header = sessionStorage.getItem("rml_header");
const atol_header = sessionStorage.getItem("atol_header");
const btn_text = sessionStorage.getItem("btn_text");

populateAtolItems = function (atolItems) {
    const element = document.getElementById('AtolRatingScales');
    for(key in atolItems) {
        let language = sessionStorage.getItem("language");
        let code = '<fieldset id="fieldset' + language + key + '">' +
            '<label class="row mb-0" for="rating' + language + '_' + key + '">' +
            '<div class="col text-start ps-5">' + atolItems[key][0] + '</div>' +
             //next
            '<div class="col text-end pe-5">' + atolItems[key][1] + '</div></label>' +
            '<div class="row mb-5"><div class="col ps-4 pe-4"><input type="range" class="form-range" id="rating_' + language + '_' + key + '"/>' +
            '<div class="form-check ps-5"><div class="invalid-feedback">' + instruction + '</div></div></div></div></fieldset>';
        element.insertAdjacentHTML('beforeend', code);
            }
    }

    eel.atol_c_get_items(chosenVersion)(populateAtolItems);


function outputData() {
        const selectSurveyVersion = sessionStorage.getItem("atolVersion");
        const researcherId = sessionStorage.getItem("atolResId");
        const researchLocation = sessionStorage.getItem("atolLocation");
        const partId = sessionStorage.getItem("atolPartId");
        
        document.getElementById("atolVersion").innerHTML = "DATA from PYTHON is: " + get_data_from_python() +
                                                            "<br>Survey version is: " + selectSurveyVersion +
                                                           "<br>Researcher is: " + researcherId +
                                                           "<br>Location is: " + researchLocation +
                                                           "<br>Participant is: " + partId;
                                                           
        }

        

</script>

{% endblock %}
{% block headline %}<script type="text/javascript">document.write(title);</script>{% endblock %}

{% block head_styles %}{% endblock %}
{% block drawer_info %}{% endblock %}
{% block drawer_nav_options %}
    <li class="nav-item">
        <a class="nav-link" onClick="discard_attempt()"><i class="bi bi-x-circle"></i>  Discard attempt</a>
    </li>
    <li><hr class="nav-divider"></li>
{% endblock %}
{% block content %}
    <article class="container-fluid p-2">
        <div class="progress">
            <div class="progress-bar bg-info" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" style="width:0%"></div>
        </div>
        <div class="row m-2 text-center">
            <h2><script type = "text/javascript">document.write(atol_header);</script></h2>
        </div>

        <!-- tetsing whether we can pick up language choice-->
        <div id="atolVersion">
            <script type="text/javascript">        
            outputData();
            </script>
        </div>

        <form id="surveyAtolForm_majLang"> <!-- action="part2.html">-->

            <!-- Name language statement to agree with... -->
            <div class="row mt-5 mb-0">
                <div class="col"><p id="language_header"><h4>
                    <script type="text/javascript">document.write(language_header);</script></h4>
                </p>
                    
                </div>
            </div>

            <!-- Instructions -->
            <div class="row mt-0 mb-0">
                <div class="col">
                    <p class="help-block p-2 text-muted"><i class="bi-info-circle text-info"></i> 
                        <script type="text/javascript">document.write(instruction)</script></p>
                </div>
            </div>

            <div id="AtolRatingScales">
                <!-- Placeholder where JavaScript will insert sliders -->
            </div>
            
        
            <!-- Form submission -->
            <div class="row text-end p-3">
                <div clas="col">
                    <button type="submit" class="btn btn-primary btn-lg btn-action shadow">
                        <script type="text/javascript">document.write(btn_text)</script>
                    </button>
                </div>
            </div>
        </form>
    </article>
{% endblock %}
{% block tail_scripts %}
<script type="text/javascript">
    lart.forms.requireValidation(true);
    lart.forms.registerPipeline(
        'surveyAtolForm_majLang',
        async function(data) {

            let success = await eel.grab_atol_ratings(data, 'atolRatingsMaj')();
            console.log("tail script: " + success);
           
        }
    );
</script>
{% endblock %}
